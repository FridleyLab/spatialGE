<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>STlist: Creation of STlist objects for spatial transcriptomics analysis — STlist • spatialGE</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="STlist: Creation of STlist objects for spatial transcriptomics analysis — STlist"><meta property="og:description" content="Creates an STlist object from one or multiple spatial transcriptomic samples."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spatialGE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/basic_functions_vignette.html">Basic functionality: Visualization, domain detection, and spatial heterogeneity</a>
    </li>
    <li>
      <a href="../articles/spatial_differential_expression.html">Spatially-informed differential gene expression</a>
    </li>
    <li>
      <a href="../articles/spatial_enrichment_gradients_smi.html">Detection of gene set spatial patterns and expression gradients in CosMx-SMI</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>STlist: Creation of STlist objects for spatial transcriptomics analysis</h1>
    
    <div class="hidden name"><code>STlist.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Creates an STlist object from one or multiple spatial transcriptomic samples.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">STlist</span><span class="op">(</span>rnacounts <span class="op">=</span> <span class="cn">NULL</span>, spotcoords <span class="op">=</span> <span class="cn">NULL</span>, samples <span class="op">=</span> <span class="cn">NULL</span>, cores <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>rnacounts</dt>
<dd><p>the count data which can be provided in one of these formats:</p><ul><li><p>File paths to comma- or tab-delimited files containing raw gene counts, one file
for each spatial sample. The first column contains gene names and subsequent columns
contain the expression data for each cell/spot. Duplicate gene names will be
modified using <code>make.unique</code>. Requires <code>spotcoords</code> and <code>samples</code></p></li>
<li><p>File paths to Visium output directories (one per spatial sample). The directory
should follow the structure resulting from <code>spaceranger count</code>. The directory contains
the <code>.h5</code> and <code>spatial</code> sub-directory. If no <code>.h5</code> file is available, sparse
matrices (MEX) from <code>spaceranger count</code>. In that case a second sub-directory
called <code>filtered_feature_bc_matrix</code> should contain contain the <code>barcodes.tsv.gz</code>,
<code>features.tsv.gz</code>, and <code>matrix.mtx.gz</code> files. The <code>spatial</code> sub-directory minimally
contains the coordinates (<code>tissue_positions_list.csv</code>), and optionally the high
resolution PNG image and accompanying scaling factors (<code>scalefactors_json.json</code>).
Requires <code>samples</code></p></li>
<li><p>The <code>exprMat</code> file for each slide of a CosMx-SMI output. The file must contain
the "fov" and "cell_ID" columns. The <code>STlist</code> function will separate data from each
FOV, since analysis in spatialGE is conducted at the FOV level. Requires <code>samples</code> and
<code>spotcoords</code></p></li>
<li><p>A named list of data frames with raw gene counts (one data frame per spatial
sample). Requires <code>spotcoords</code></p></li>
</ul></dd>


<dt>spotcoords</dt>
<dd><p>the cell/spot coordinates. Not required if inputs are Visium
space ranger outputs</p><ul><li><p>File paths to comma- or tab-delimited files containing cell/spot coordinates, one
for each spatial sample. The files must contain three columns: cell/spot IDs, Y positions, and
X positions. The cell/spot IDs must match the column names for each cells/spots (columns) in
the gene count files</p></li>
<li><p>The <code>metadata</code> file for each slide of a CosMx-SMI output. The file must contain
the "fov", "cell_ID", "CenterX_local_px", and "CenterY_local_px" columns. The <code>STlist</code>
function will separate data from each FOV, since analysis in spatialGE is conducted at
the FOV level. Requires <code>samples</code> and <code>rnacounts</code></p></li>
<li><p>A named list of data frames with cell/spot coordinates. The list names must
match list names of the gene counts list</p></li>
</ul></dd>


<dt>samples</dt>
<dd><p>the sample names/IDs and (optionally) metadata associated with
each spatial sample. This file can also include files paths to gene counts and
cell/spot coordinate files, bypassing the need to specify <code>rnacounts</code> and <code>spotcoords</code>.
The following options are available for <code>samples</code>:</p><ul><li><p>A vector with sample names, which will be used to partially match gene
counts and cell/spot coordinates file paths. A sample name must not match file
paths for two different samples</p></li>
<li><p>A path to a file containing a table with metadata. This file is a comma- or
tab-separated table with one sample per row and sample names/IDs in the first
column. Paths to gene counts and coordinate files can be placed in the second and
third columns respectively (while leaving the <code>rnacounts</code> and <code>spotcoords</code> arguments
empty). If Visium directories are provided, only the second column with paths to
<code>spaceranger count</code> directories are expected. Subsequent columns can contain
variables associated with each spatial sample</p></li>
</ul></dd>


<dt>cores</dt>
<dd><p>integer indicating the number of cores to use during parallelization.
If NULL, the function uses half of the available cores at a maximum. The parallelization
uses <code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">parallel::mclapply</a></code> and works only in Unix systems.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>x an STlist object containing the counts and coordinates, and optionally
the sample metadata, which can be used for downstream analysis with <code>spatialGE</code></p>


    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Objects of the S4 class STlist are the starting point of analyses in <strong><code>spatialGE</code></strong>.
The STlist contains data from one or multiple samples (i.e., tissue slices), and
results from most <code>spatialGE</code>'s functions are stored within the object.</p><ul><li><p>Raw gene counts and spatial coordinates. Gene count data have genes in rows and
sampling units (e.g., cells, spots, ROIs) in columns. Spatial coordinates have
sampling units in rows and three columns: sample unit IDs, Y position, and X position.</p></li>
<li><p>Visium outputs from <em>space ranger</em>. The Visium directory should generally have
the file structure resulting from <code>spaceranger count</code>, with either a count matrix
represented in MEX files or a h5 file. The directory should also contain a <code>spatial</code>
sub-directory, with the spatial coordinates (<code>tissue_positions_list.csv</code>), and
optionally the high resolution tissue image and scaling factor file <code>scalefactors_json.json</code>.</p></li>
<li><p>CosMx-SMI outputs. Two files are required to process SMI outputs: The <code>exprMat</code> and
<code>metadata</code> files. Both files must contain the "fov" and "cell_ID" columns. In addition,
the <code>metadata</code> files must contain the "CenterX_local_px" and "CenterY_local_px" columns.</p></li>
</ul><p>Optionally, the user can input a path to a file containing a table of sample-level
metadata (e.g., clinical outcomes, tissue type, age). This sample metadata file
should contain sample IDs in the first column partially matching the file names of
the count/coordinate file paths or Visium directories.</p>
<p>The function uses parallelization if run in a unix system. Windows users
will experience longer times depending on the number of samples.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># Using included melanoma example (Thrane et al.)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">'spatialGE'</span><span class="op">)</span></span>
<span class="r-in"><span class="va">data_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package<span class="op">=</span><span class="st">"spatialGE"</span><span class="op">)</span>, recursive<span class="op">=</span><span class="cn">T</span>, full.names<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span class="r-in"><span class="va">count_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"counts"</span>, <span class="va">data_files</span>, value<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span class="r-in"><span class="va">coord_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"mapping"</span>, <span class="va">data_files</span>, value<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span class="r-in"><span class="va">clin_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"thrane_clinical"</span>, <span class="va">data_files</span>, value<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span class="r-in"><span class="va">melanoma</span> <span class="op">&lt;-</span> <span class="fu">STlist</span><span class="op">(</span>rnacounts<span class="op">=</span><span class="va">count_files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span>, spotcoords<span class="op">=</span><span class="va">coord_files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span>, samples<span class="op">=</span><span class="va">clin_file</span><span class="op">)</span> <span class="co"># Only first two samples</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Sample ST_mel2_rep1 was not found among the count/coordinate files.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Sample ST_mel2_rep2 was not found among the count/coordinate files.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Sample ST_mel3_rep1 was not found among the count/coordinate files.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Sample ST_mel3_rep2 was not found among the count/coordinate files.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Sample ST_mel4_rep1 was not found among the count/coordinate files.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Sample ST_mel4_rep2 was not found among the count/coordinate files.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">Found matrix data</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">Matching gene expression and coordinate data...</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">Converting counts to sparse matrices</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00; font-weight: bold;">Completed STlist!</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="va">melanoma</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial Transcriptomics List (STlist).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 spatial array(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	ST_mel1_rep1 (279 ROIs|spots|cells x 15666 genes)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	ST_mel1_rep2 (293 ROIs|spots|cells x 16148 genes)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 variables in sample-level data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	 patient, slice, gender, BRAF_status, NRAS_status, CDKN2A_status, survival, survival_months, RIN </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Oscar Ospina, Brooke Fridley, Alex Soupir.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

