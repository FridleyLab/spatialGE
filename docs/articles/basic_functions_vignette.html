<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="spatialGE">
<title>Basic functionality • spatialGE</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basic functionality">
<meta property="og:description" content="spatialGE">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">spatialGE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/basic_functions_vignette.html">Basic functionality</a>
    <a class="dropdown-item" href="../articles/spatial_differential_expression.html">Spatially-informed differential gene expression</a>
    <a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="basic_functions_vignette_files/kePrint-0.0.1/kePrint.js"></script><link href="basic_functions_vignette_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Basic functionality</h1>
            
            <h4 data-toc-skip class="date">2023-09-01</h4>
      
      
      <div class="d-none name"><code>basic_functions_vignette.Rmd</code></div>
    </div>

    
    
<p>The package <strong><em><code>spatialGE</code></em></strong> provides
a collection of tools for the visualization of gene expression from
spatially-resolved transcriptomic experiments. The data input methods
have been designed so that any data can be analyzed as long as it
contains gene expression counts per region of interest (ROI), spot, or
cell, and the spatial coordinates of those ROIs, spots, or cells, as it
is generated in platforms such as GeoMx, Visium, and CosMx-SMI.
Specialized data input options are available to allow interoperability
with workflows such as <a href="https://support.10xgenomics.com/spatial-gene-expression/software/pipelines/latest/what-is-space-ranger" class="external-link"><em>Space
Ranger</em></a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The <code>spatialGE</code> repository is available at GitHub and can
be installed via <code>devtools</code>. To install <code>devtools</code>
(in case it is not already installed in your R), please run the
following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="st">"devtools"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>After making sure <code>devtools</code> is installed, proceed to
install <code>spatialGE</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#devtools::install_github("fridleylab/spatialGE")</span></code></pre></div>
<p>To use <code>spatialGE</code>, load the package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">'spatialGE'</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="spatially-resolved-expression-of-triple-negative-breast-cancer-tumor-biopsies">Spatially-resolved expression of triple negative breast cancer tumor
biopsies<a class="anchor" aria-label="anchor" href="#spatially-resolved-expression-of-triple-negative-breast-cancer-tumor-biopsies"></a>
</h2>
<p>To show the utility of some of the functions in
<code>spatialGE</code>, we use the spatial transcriptomics data set
generated with the platform Visium by <span class="citation">Bassiouni
et al. (2023)</span>. This data set includes triple negative breast
cancer biopsies from 22 patients, with two tissue slices per patient.
The Visium platform allows gene expression quantitation in approximately
5000 capture areas (i.e., “spots”) separated each other by 100μM. The
spots are 55μM in diameter, which corresponds to 1-10 cells <a href="https://kb.10xgenomics.com/hc/en-us/articles/360035487952-How-many-cells-are-captured-in-a-single-spot-" class="external-link">according
to the manufacturer</a>.</p>
<p>Data for all the tissue slices are available at the Gene Expression
Omnibus (GEO). For the purpose of this tutorial, we will use eight
samples from four patients. The GEO repositories can be accessed using
the following links:</p>
<ul>
<li><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM6433599" class="external-link">sample_117d</a></li>
<li><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM6433600" class="external-link">sample_117e</a></li>
<li><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM6433611" class="external-link">sample_120d</a></li>
<li><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM6433612" class="external-link">sample_120e</a></li>
<li><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM6433585" class="external-link">sample_092a</a></li>
<li><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM6433586" class="external-link">sample_092b</a></li>
<li><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM6433593" class="external-link">sample_094c</a></li>
<li><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM6433594" class="external-link">sample_094d</a></li>
</ul>
<p>Within each link, locate the files
<code>filtered_feature_bc_matrix.h5</code>,
<code>tissue_positions_list.csv.gz</code>,
<code>tissue_hires_image.png.gz</code>, and
<code>scalefactors_json.json.gz</code> files and download them. Create a
folder in your Desktop with the name <code>tnbc_visium</code>. Within
that folder, create eight folders, each with the sample names previously
shown (i.e., <code>sample_117d</code>, <code>sample_117e</code>,
<code>sample_120d</code>, …). Next, place within each folder the
corresponding <code>filtered_feature_bc_matrix.h5</code> file. Then,
create within each folder, another folder named <code>spatial</code> and
place the corresponding <code>tissue_positions_list.csv.gz</code>,
<code>tissue_hires_image.png.gz</code>, and
<code>scalefactors_json.json.gz</code> files within that
<code>spatial</code> folder. The files within <code>spatial</code> must
be decompressed, which is achieved by double-clicking each file. This
file structure, corresponds roughly to the file structure in outputs
generated by Space Ranger, the software provided by 10X Genomics to
process Visium data.</p>
<p align="center">
<img src="../../articles/dir_structure.png" height="550" width="550"></p>
</div>
<div class="section level2">
<h2 id="creating-an-stlist-spatial-transcriptomics-list">Creating an STList (Spatial Transcriptomics List)<a class="anchor" aria-label="anchor" href="#creating-an-stlist-spatial-transcriptomics-list"></a>
</h2>
<p>In <code>spatialGE</code>, raw and processed data are stored in an
<strong><em>STlist</em></strong> (S4 class object). The STlist can be
created with the function <code>STlist</code>, which can take data using
different formats (see <a href="https://fridleylab.github.io/spatialGE/reference/STlist.html" class="external-link">here</a>
for more info or type <code><a href="../reference/STlist.html">?STlist</a></code> in the R console). In this
tutorial we will provide the file paths to the folders created in the
previous step.</p>
<p>Additionally, we will input meta data associated with each sample.
The meta data is provided in the form of a comma-delimited file. We have
extracted some of the clinical meta data for the eight samples from the
original publication and saved it as part of the <code>spatialGE</code>
package. The user is encouraged to look at the structure of this file by
downloading it from the <a href="https://github.com/FridleyLab/spatialGE/tree/main/inst/extdata/tnbc_bassiouni/bassiouni_clinical.csv" class="external-link">GitHub
repository</a>. The most important aspect when constructing this file is
that the sample names are in the first column, and they match the names
of the folders containing the data:</p>
<p align="center">
<img src="../../articles/metadata_file.png" height="250" width="550"></p>
<p>Once the folders with samples have been created, we can use R to
generate the file paths to be passed to the <code>STlist</code>
function. Assuming that the user created the folder in the computer’s
Desktop:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">visium_folders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.dirs</a></span><span class="op">(</span><span class="st">'~/Desktop/tnbc_visium/'</span>, full.names<span class="op">=</span><span class="cn">T</span>, recursive<span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<p>The meta data can be accessed directly from the
<code>spatialGE</code> package installed in the computer like so:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/tnbc_bassiouni"</span>, package<span class="op">=</span><span class="st">"spatialGE"</span><span class="op">)</span>
<span class="va">clin_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_files</span>, full.names<span class="op">=</span><span class="cn">T</span>, recursive<span class="op">=</span><span class="cn">F</span>, pattern<span class="op">=</span><span class="st">'clinical'</span><span class="op">)</span></code></pre></div>
<p>We can load the files into an STlist using this command:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tnbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STlist.html">STlist</a></span><span class="op">(</span>rnacounts<span class="op">=</span><span class="va">visium_folders</span>, samples<span class="op">=</span><span class="va">clin_file</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #00BB00;">Found Visium data</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; </span><span style="color: #00BB00; font-weight: bold;">Found 8 Visium samples</span></span>
<span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt;   Data read completed</span></span>
<span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span><span style="color: #BBBB00;">Matching gene expression and coordinate data...</span></span>
<span class="co"><span style="color: #BBBB00;">#&gt; </span><span style="color: #00BB00; font-weight: bold;">Completed STlist!</span></span>
<span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span></span></code></pre></div>
<p>The <code>tnbc</code> object is an STlist that contains the count
data, spot coordinates, and clinical meta data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tnbc</span>
<span class="co">#&gt; Spatial Transcriptomics List (STlist).</span>
<span class="co">#&gt; 8 spatial array(s):</span>
<span class="co">#&gt;  sample_117d (1949 ROIs|spots|cells x 23755 genes)</span>
<span class="co">#&gt;  sample_117e (754 ROIs|spots|cells x 21662 genes)</span>
<span class="co">#&gt;  sample_120d (1359 ROIs|spots|cells x 21886 genes)</span>
<span class="co">#&gt;  sample_120e (844 ROIs|spots|cells x 20389 genes)</span>
<span class="co">#&gt;  sample_092a (1289 ROIs|spots|cells x 24227 genes)</span>
<span class="co">#&gt;  sample_092b (1376 ROIs|spots|cells x 23511 genes)</span>
<span class="co">#&gt;  sample_094c (1542 ROIs|spots|cells x 24581 genes)</span>
<span class="co">#&gt;  sample_094d (1391 ROIs|spots|cells x 24167 genes)</span>
<span class="co">#&gt;  NA ( ROIs|spots|cells x  genes)</span>
<span class="co">#&gt;  NA ( ROIs|spots|cells x  genes)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 3 variables in sample-level data:</span>
<span class="co">#&gt;   patient_id, neoadjuvant, overall_survival_days</span></code></pre></div>
<p>As observed, by calling the <code>tnbc</code> object, information on
the number of spots and genes per sample is displayed. For count
statistics, the <code>summarize_STlist</code> function can be used:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summarize_STlist.html">summarize_STlist</a></span><span class="op">(</span><span class="va">tnbc</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 9</span></span>
<span class="co">#&gt;   sample_name spotscells genes min_cou…¹ mean_…² max_c…³ min_g…⁴ mean_…⁵ max_g…⁶</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> sample_117d       <span style="text-decoration: underline;">1</span>949 <span style="text-decoration: underline;">23</span>755       828  <span style="text-decoration: underline;">35</span>264.  <span style="text-decoration: underline;">107</span>737     533   <span style="text-decoration: underline;">6</span>352.    <span style="text-decoration: underline;">9</span>776</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> sample_117e        754 <span style="text-decoration: underline;">21</span>662      <span style="text-decoration: underline;">1</span>022  <span style="text-decoration: underline;">34</span>607.  <span style="text-decoration: underline;">121</span>682     632   <span style="text-decoration: underline;">6</span>141.   <span style="text-decoration: underline;">10</span>091</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> sample_120d       <span style="text-decoration: underline;">1</span>359 <span style="text-decoration: underline;">21</span>886       171  <span style="text-decoration: underline;">13</span>831.   <span style="text-decoration: underline;">54</span>618     150   <span style="text-decoration: underline;">3</span>725.    <span style="text-decoration: underline;">7</span>311</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> sample_120e        844 <span style="text-decoration: underline;">20</span>389        42   <span style="text-decoration: underline;">9</span>997.   <span style="text-decoration: underline;">91</span>663      41   <span style="text-decoration: underline;">3</span>166.    <span style="text-decoration: underline;">9</span>288</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> sample_092a       <span style="text-decoration: underline;">1</span>289 <span style="text-decoration: underline;">24</span>227       559  <span style="text-decoration: underline;">43</span>225.  <span style="text-decoration: underline;">103</span>713     413   <span style="text-decoration: underline;">6</span>951.    <span style="text-decoration: underline;">9</span>650</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> sample_092b       <span style="text-decoration: underline;">1</span>376 <span style="text-decoration: underline;">23</span>511      <span style="text-decoration: underline;">1</span>413  <span style="text-decoration: underline;">34</span>809.  <span style="text-decoration: underline;">117</span>138     721   <span style="text-decoration: underline;">5</span>959.    <span style="text-decoration: underline;">9</span>680</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> sample_094c       <span style="text-decoration: underline;">1</span>542 <span style="text-decoration: underline;">24</span>581        71  <span style="text-decoration: underline;">45</span>805.  <span style="text-decoration: underline;">206</span>674      70   <span style="text-decoration: underline;">7</span>485.   <span style="text-decoration: underline;">11</span>435</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">8</span> sample_094d       <span style="text-decoration: underline;">1</span>391 <span style="text-decoration: underline;">24</span>167       298  <span style="text-decoration: underline;">37</span>157.  <span style="text-decoration: underline;">130</span>422     242   <span style="text-decoration: underline;">7</span>061.   <span style="text-decoration: underline;">11</span>129</span>
<span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​min_counts_per_spotcell,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   ²​mean_counts_per_spotcell, ³​max_counts_per_spotcell,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   ⁴​min_genes_per_spotcell, ⁵​mean_genes_per_spotcell, ⁶​max_genes_per_spotcell</span></span></code></pre></div>
<p>The minimum number of counts per spot is 42, which seems low. We can
look at the distribution of counts and genes per spot using the
<code>distribution_plots</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution_plots.html">distribution_plots</a></span><span class="op">(</span><span class="va">tnbc</span>, plot_type<span class="op">=</span><span class="st">'violin'</span>, plot_meta<span class="op">=</span><span class="st">'total_counts'</span><span class="op">)</span>
<span class="va">cp</span><span class="op">[[</span><span class="st">'total_counts'</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/count_dstr-1.png" width="768"></p>
<p>Now, let us remove spots with low counts by keeping only those spots
with at least 5000 counts. We will also restrict the data set to spots
expressing at least 1000 genes. We also will remove a few spots that
have abnormally large number of counts, as in sample_094c. These
criteria are not a rule, and samples in each study have to be carefully
examined. For example, this criteria may be not enough to reduce the
differences in counts, especially for sample_120d and samples_120e.</p>
<p>We run this filter with the <code>filter_data</code> function:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tnbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_data.html">filter_data</a></span><span class="op">(</span><span class="va">tnbc</span>, spot_minreads<span class="op">=</span><span class="fl">5000</span>, spot_mingenes<span class="op">=</span><span class="fl">1000</span>, spot_maxreads<span class="op">=</span><span class="fl">150000</span><span class="op">)</span>

<span class="va">cp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution_plots.html">distribution_plots</a></span><span class="op">(</span><span class="va">tnbc</span>, plot_type<span class="op">=</span><span class="st">'violin'</span>, plot_meta<span class="op">=</span><span class="st">'total_counts'</span><span class="op">)</span>
<span class="va">cp2</span><span class="op">[[</span><span class="st">'total_counts'</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/filter_chunk-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="exploring-variation-between-spatial-arrays">Exploring variation between spatial arrays<a class="anchor" aria-label="anchor" href="#exploring-variation-between-spatial-arrays"></a>
</h2>
<p>The functions <code>pseudobulk_samples</code> and
<code>pseudobulk_pca_plot</code> are the initial steps to obtain a quick
snapshot of the variation in gene expression among samples. The function
<code>pseudobulk_samples</code> creates (pseudo) “bulk” RNAseq data sets
by combining all counts from each sample. Then, it log transforms the
“pseudo bulk” RNAseq counts and runs a Principal Component Analysis
(PCA). Note that the spatial coordinate information is not considered
here, which is intended only as an exploratory analysis analysis. The
<code>max_var_genes</code> argument is used to specify the maximum
number of genes used for computation of PCA. The genes are selected
based on their standard deviation across samples.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tnbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pseudobulk_samples.html">pseudobulk_samples</a></span><span class="op">(</span><span class="va">tnbc</span>, max_var_genes<span class="op">=</span><span class="fl">5000</span><span class="op">)</span></code></pre></div>
<p>In this case, we apply the function to look for agreement between
samples from the same patient: It is expected that tissue slices from
the same patient are more similar among them than tissue slices from
other patients. The <code>pseudobulk_pca</code> allows to map a
sample-level variable to the points in the PCA by including the name of
the column from the sample metadata (<code>patient_id</code> in this
example).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/pseudobulk_pca_plot.html">pseudobulk_pca_plot</a></span><span class="op">(</span><span class="va">tnbc</span>, plot_meta<span class="op">=</span><span class="st">'patient_id'</span><span class="op">)</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/pca_chunk-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Users can also generate a heatmap from pseudobulk counts by calling
the <code>pseudobulk_heatmap</code> function, which also requires prior
use of the <code>pseudobulk_samples</code> function. The number of
variable genes to show can be controlled via the
<code>hm_display_genes</code> argument.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hm_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pseudobulk_heatmap.html">pseudobulk_heatmap</a></span><span class="op">(</span><span class="va">tnbc</span>, plot_meta<span class="op">=</span><span class="st">'patient_id'</span>, hm_display_genes<span class="op">=</span><span class="fl">30</span><span class="op">)</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/heatmap_chunk-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="transformation-of-spatially-resolved-transcriptomics-data">Transformation of spatially-resolved transcriptomics data<a class="anchor" aria-label="anchor" href="#transformation-of-spatially-resolved-transcriptomics-data"></a>
</h2>
<p>Many transformation methods are available for RNAseq count data. In
<code>spatialGE</code>, the function <code>transform_data</code> applies
log-transformation to the counts, after library size normalization
performed on each sample separately. Similar to <a href="https://satijalab.org/seurat/reference/normalizedata" class="external-link">Seurat</a>,
it applies a scaling factor (<code>scale_f=10000</code> by default).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tnbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transform_data.html">transform_data</a></span><span class="op">(</span><span class="va">tnbc</span>, method<span class="op">=</span><span class="st">'log'</span><span class="op">)</span></code></pre></div>
<p>Users also can apply variance-stabilizing transformation (SCT; <span class="citation">Hafemeister and Satija (2019)</span>), which is another
method increasingly used in single-cell and spatial transcriptomics
studies. See <a href="https://fridleylab.github.io/spatialGE/reference/transform_data.html" class="external-link">here</a>
for details.</p>
</div>
<div class="section level2">
<h2 id="visualization-of-gene-expression-from-spatially-resolved-transcriptomics-data">Visualization of gene expression from spatially-resolved
transcriptomics data<a class="anchor" aria-label="anchor" href="#visualization-of-gene-expression-from-spatially-resolved-transcriptomics-data"></a>
</h2>
<p>After data transformation, expression of specific genes can be
visualized using “quilt” plots. The function <code>STplot</code> shows
the transformed expression of one or several genes. We have adopted the
color palettes from the packages <code>khroma</code> and
<code>RColorBrewer</code>. The name of a color palette can be passed
using the argument <code>color_pal</code>. The default behavior of the
function produces plots for all samples within the STlist, but we can
pass specific samples to be plotted using the argument
<code>samples</code>.</p>
<p>Let’s produce a quilt plot for the genes <em>NDRG1</em> and
<em>IGKC</em> (hypoxia and B-cell markers, respectively), for sample
number 1 of patient 14 (<code>samples=sample_094c</code>).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">quilts1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STplot.html">STplot</a></span><span class="op">(</span><span class="va">tnbc</span>, 
                  genes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NDRG1'</span>, <span class="st">'IGKC'</span><span class="op">)</span>, 
                  samples<span class="op">=</span><span class="st">'sample_094c'</span>, 
                  color_pal<span class="op">=</span><span class="st">'BuRd'</span>, 
                  ptsize<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p>Because <code>spatialGE</code> functions output lists of ggplot
objects, we can plot the results side-by-side using functions such as
<code>ggarrange()</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist<span class="op">=</span><span class="va">quilts1</span>, nrow<span class="op">=</span><span class="fl">1</span>, ncol<span class="op">=</span><span class="fl">2</span>, legend<span class="op">=</span><span class="st">'bottom'</span><span class="op">)</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/genequilt_chunk2-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We can see that gene expression patterns of both genes are
non-overlapping: <em>IGKC</em> is expressed in the upper right portion
of the tissue, whereas <em>NDRG1</em> is expressed in the right bottom
portion (although relatively lower compared to <em>IGKC</em> as
indicated by the white-colored spots). The location of gene expression
of those two genes may be indicative of an immune-infiltrated area and a
tumor area. With the help of spatial interpolation, visualization of
these regions can be easier as will be showed next.</p>
<div class="section level3">
<h3 id="spatial-interpolation-of-gene-expression">Spatial interpolation of gene expression<a class="anchor" aria-label="anchor" href="#spatial-interpolation-of-gene-expression"></a>
</h3>
<p>We can predict a smooth gene expression surface for each sample. In
<code>spatialGE</code>, this prediction is achieved by using a spatial
interpolation method very popular in spatial statistics. The method
known as ‘kriging’ allows the estimation of gene expression values in
the un-sampled areas between spots, or cells/spots that were filtered
during data quality control. Estimating a transcriptomic surface via
kriging assumes that gene expression of two given points is correlated
to the spatial distance between them.</p>
<p>The function <code>gene_interpolation</code> performs kriging of gene
expression via the <code>fields</code> package. We specify that kriging
will be performed for two of the spatial samples
(<code>samples=c('sample_094c', 'sample_117e')</code>):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tnbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gene_interpolation.html">gene_interpolation</a></span><span class="op">(</span><span class="va">tnbc</span>, 
                           genes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NDRG1'</span>, <span class="st">'IGKC'</span><span class="op">)</span>,
                           samples<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sample_094c'</span>, <span class="st">'sample_117e'</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #00BB00;">Gene interpolation started.</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; Gene interpolation completed in 1.64 min.</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; </span></span></code></pre></div>
<p>Generating gene expression surfaces can be time consuming. The finer
resolution to which the surface is to be predicted (<code>ngrid</code>
argument), the longer the time it takes. The execution time also depends
on the number of spots/cells. The surfaces can be visualized using the
<code><a href="../reference/STplot_interpolation.html">STplot_interpolation()</a></code> function:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kriges1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STplot_interpolation.html">STplot_interpolation</a></span><span class="op">(</span><span class="va">tnbc</span>,
                                genes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NDRG1'</span>, <span class="st">'IGKC'</span><span class="op">)</span>,
                                samples<span class="op">=</span><span class="st">'sample_094c'</span><span class="op">)</span>
<span class="co">#&gt; Loading required namespace: rgeos</span>
<span class="co">#&gt; Loading required package: ggpolypath</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist<span class="op">=</span><span class="va">kriges1</span>, nrow<span class="op">=</span><span class="fl">1</span>, ncol<span class="op">=</span><span class="fl">2</span>, common.legend<span class="op">=</span><span class="cn">T</span>, legend<span class="op">=</span><span class="st">'bottom'</span><span class="op">)</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/plotkrige_chunk1-1.png" width="768" style="display: block; margin: auto;"></p>
<p>By looking at the transcriptomic surfaces of the two genes, it is
easier to detect where “pockets” of high and low expression are located
within the tissue. It is now more evident that expression of
<em>NDRG1</em> is higher in the lower right region of the tumor slice,
as well in a smaller area to the left (potentially another hypoxic
region).</p>
<p>If tissue images were uploaded to the STlist
(<code>tissue_hires_image.png.gz</code>), it can be displayed for
comparison using the <code>plot_image</code> function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ip</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_image.html">plot_image</a></span><span class="op">(</span><span class="va">tnbc</span>, samples<span class="op">=</span><span class="st">'sample_094c'</span><span class="op">)</span>

<span class="va">ip</span><span class="op">[[</span><span class="st">'image_sample_094c'</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/plot_tissue-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="unsupervised-spatially-informed-clustering-stclust">Unsupervised spatially-informed clustering (<em>STclust</em>)<a class="anchor" aria-label="anchor" href="#unsupervised-spatially-informed-clustering-stclust"></a>
</h2>
<p>Detecting tissue compartments or niches is an important part of the
study of the tissue architecture. We can do this by applying
<strong><em><code>STclust</code></em></strong>, a spatially-informed
clustering method implemented in <code>spatialGE</code>. The
<code>STclust</code> method uses weighted average matrices to capture
the transcriptomic differences among the cells/spots. As a first step in
<code>STclust</code>, top variable genes are identified via Seurat’s
<code>FindVariableFeatures</code>, and transcriptomic scaled distances
are calculated using only those genes. Next, scaled euclidean distances
are computed from the spatial coordinates of the spots/cells. The user
defines a weight (<code>ws</code>) from 0 to 1, to apply to the physical
distances. The higher the weight, the less biologically meaningful the
clustering solution is, given that the clusters would only reflect the
physical distances between the spots/cells and less information on the
transcriptomic profiles will be used. After many tests, we have found
that weights between 0.025 - 0.25 are enough to capture the tissue
heterogeneity. By default, <code>STclust</code> uses dynamic tree cuts
<span class="citation">(Langfelder, Zhang, and Horvath 2007)</span> to
define the number of clusters. But users can also test a series of k
values (<code>ks</code>). For a more detailed description of the method,
please refer to the paper describing <code>spatialGE</code> and
<code>STclust</code> <span class="citation">(Ospina et al.
2022)</span>.</p>
<p>We’ll try several weights to see it’s effect on the cluster
assignments:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tnbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STclust.html">STclust</a></span><span class="op">(</span><span class="va">tnbc</span>, 
                ks<span class="op">=</span><span class="st">'dtc'</span>, 
                ws<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #00BB00;">STclust started.</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; STclust completed in 0.83 min.</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; </span></span></code></pre></div>
<p>Results of clustering can be plotted via the <code>STplot</code>
function:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cluster_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STplot.html">STplot</a></span><span class="op">(</span><span class="va">tnbc</span>, 
                    samples<span class="op">=</span><span class="st">'sample_094c'</span>, 
                    ws<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span><span class="op">)</span>,
                    color_pal<span class="op">=</span><span class="st">'highcontrast'</span><span class="op">)</span>
<span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist<span class="op">=</span><span class="va">cluster_p</span>, nrow<span class="op">=</span><span class="fl">2</span>, ncol<span class="op">=</span><span class="fl">2</span>, legend<span class="op">=</span><span class="st">'right'</span><span class="op">)</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/plotclustspots_chunk-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We can see that from <code>w=0</code> and <code>w=0.05</code>, we can
only detect two tissue niches. At <code>w=0.025</code>, we gain higher
resolution as one of the clusters is split and a third (‘yellow’)
cluster appears, potentially indicating that an different
transcriptional profile is present there. At <code>w=0.2</code>, the
clusters seem too compact, indicating that the weight of spatial
information is probably too high. We have used here the dynamic tree
cuts (<code>dtc</code>) to automatically select the number of clusters,
resulting in very coarse resolution tissue niches, however, users can
define their own range of k to be evaluated, allowing further detection
of tissue compartments.</p>
</div>
<div class="section level2">
<h2 id="association-between-spatial-heterogeneity-and-sample-level-variables">Association between spatial heterogeneity and sample-level
variables<a class="anchor" aria-label="anchor" href="#association-between-spatial-heterogeneity-and-sample-level-variables"></a>
</h2>
<p>To explore the relationship between a clinical (sample-level)
variable of interest and the level of gene expression spatial uniformity
within a sample, we can use the <code><a href="../reference/SThet.html">SThet()</a></code> function:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tnbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SThet.html">SThet</a></span><span class="op">(</span><span class="va">tnbc</span>, 
              genes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NDRG1'</span>, <span class="st">'IGKC'</span><span class="op">)</span>,
              method<span class="op">=</span><span class="st">'moran'</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #00BB00;">SThet started.</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; </span><span style="color: #BBBB00;">   Calculating spatial weights...</span></span>
<span class="co"><span style="color: #BBBB00;">#&gt; </span><span style="color: #00BB00;">SThet completed in 0.23 min.</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; </span></span></code></pre></div>
<p>The <code>SThet</code> function calculates the Moran’s I statsitic
(or Geary’s C) to measure the level of spatial heterogeneity in the
expression of the genes ( <em>NDRG1</em>, <em>IGKC</em>). The estimates
can be compared across samples using the function
<code><a href="../reference/compare_SThet.html">compare_SThet()</a></code></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_SThet.html">compare_SThet</a></span><span class="op">(</span><span class="va">tnbc</span>, 
                   samplemeta<span class="op">=</span><span class="st">'overall_survival_days'</span>, 
                   color_by<span class="op">=</span><span class="st">'patient_id'</span>,
                   gene<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NDRG1'</span>, <span class="st">'IGKC'</span><span class="op">)</span>, 
                   color_pal<span class="op">=</span><span class="st">'muted'</span>,
                   ptsize<span class="op">=</span><span class="fl">3</span><span class="op">)</span>

<span class="va">p</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/clinplot_chunk-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The calculation of spatial statistics with <code>SThet</code> and and
multi-sample comparison with <code>compare_SThet</code> provides and
easy way to identify samples and genes exhibiting spatial patterns. The
previous figure shows that expression of <em>NDRG1</em> is more
spatially uniform (lower Moran’s I) across the tissues in samples from
patients 2 and 8 compared to patents 9 and 14. The samples with higher
spatial uniformity in the expression of <em>NDRG1</em> also tended to
have higher overall survival. Trends are less clear for <em>IGKC</em>,
however, it looks like samples where expression of <em>IGKC</em> was
spatially aggregated in “pockets” (higher Moran’s I) tended to have
lower survival (but note that patient 9 does not follow this trend). As
studies using spatial transcriptomics become larger, more samples will
provide more insightful patterns into the association of gene expression
spatial distribution and non-spatial traits associated with the
tissues.</p>
<p>The computed statistics are stored in the STlist for additional
analysis/plotting that the user may want to complete. The statistics
value can be accessed as a data frame using the
<code>get_gene_meta</code> function:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_gene_meta.html">get_gene_meta</a></span><span class="op">(</span><span class="va">tnbc</span>, sthet_only<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 10</span></span>
<span class="co">#&gt;    sample  patie…¹ neoad…² overa…³ gene  gene_…⁴ gene_…⁵ vst.v…⁶ moran_i geary_c</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> sample…       2 yes        <span style="text-decoration: underline;">2</span>733 IGKC    3.07    0.787    9.73  0.077<span style="text-decoration: underline;">8</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> sample…       2 yes        <span style="text-decoration: underline;">2</span>733 NDRG1   2.13    0.436    1.74  0.081<span style="text-decoration: underline;">8</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> sample…       2 yes        <span style="text-decoration: underline;">2</span>733 IGKC    2.54    0.799   12.6   0.081<span style="text-decoration: underline;">3</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> sample…       2 yes        <span style="text-decoration: underline;">2</span>733 NDRG1   2.45    0.502    1.66  0.157  <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> sample…       8 no         <span style="text-decoration: underline;">1</span>453 IGKC    2.98    1.37    14.0   0.133  <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> sample…       8 no         <span style="text-decoration: underline;">1</span>453 NDRG1   0.672   0.514    3.11  0.030<span style="text-decoration: underline;">3</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> sample…       8 no         <span style="text-decoration: underline;">1</span>453 IGKC    2.77    1.23     7.80  0.119  <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> sample…       8 no         <span style="text-decoration: underline;">1</span>453 NDRG1   1.05    0.714    1.97  0.131  <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> sample…       9 no          308 IGKC    0.371   0.626   11.4   0.091<span style="text-decoration: underline;">6</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> sample…       9 no          308 NDRG1   1.11    0.734    5.89  0.237  <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> sample…       9 no          308 IGKC    0.105   0.412    9.54  0.056<span style="text-decoration: underline;">1</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> sample…       9 no          308 NDRG1   1.63    0.872    4.08  0.116  <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> sample…      14 yes         718 IGKC    4.06    1.60     6.31  0.203  <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> sample…      14 yes         718 NDRG1   1.38    0.780    6.04  0.199  <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span> sample…      14 yes         718 IGKC    3.23    1.43     9.12  0.164  <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">16</span> sample…      14 yes         718 NDRG1   1.25    0.768    6.69  0.174  <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​patient_id, ²​neoadjuvant,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   ³​overall_survival_days, ⁴​gene_mean, ⁵​gene_stdevs,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   ⁶​vst.variance.standardized</span></span></code></pre></div>
<details><summary><strong>How can the statistics generated by <code>SThet</code> can be
interpreted? </strong>
</summary><p>See the table below for a simplistic interpretation of the spatial
autocorrelation statistics calculated in <code>spatialGE</code>:</p>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;">
Statistic
</th>
<th style="text-align:center;">
Clustered expression
</th>
<th style="text-align:center;">
No expression pattern
</th>
<th style="text-align:center;">
Uniform expression
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
Moran’s I
</td>
<td style="text-align:center;">
Closer to 1
</td>
<td style="text-align:center;">
Closer to 0
</td>
<td style="text-align:center;">
Closer to -1
</td>
</tr>
<tr>
<td style="text-align:center;">
Geary’s C
</td>
<td style="text-align:center;">
Closer to 0
</td>
<td style="text-align:center;">
Closer to 1
</td>
<td style="text-align:center;">
Closer to 2
</td>
</tr>
</tbody>
</table>
<p>To better understand how the Moran’s I and Geary’s C statistics
quantify spatial heterogeneity, tissue can be simulated using the
<code>sc.SpatialSIM</code> and <code>spatstat</code> packages. Also
<code>tidyverse</code> and <code>janitor</code> for some data
manipulation.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://spatstat.org/" class="external-link">'spatstat'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/FridleyLab/mIFsim" class="external-link">'sc.SpatialSIM'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org" class="external-link">'tidyverse'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/sfirke/janitor" class="external-link">'janitor'</a></span><span class="op">)</span></code></pre></div>
<p>The <code>sc.SpatialSIM</code> package uses spatial point processes
to simulate the locations of spots/cells within a tissue. To facilitate
interpretability of the Moran’s I and Geary’s C statistics, first tissue
will be simulated, and then gene expression values will be
simulated.</p>
<p>The first step is to create a <code>spatstat</code> observation
window:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wdw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/owin.html" class="external-link">owin</a></span><span class="op">(</span>xrange<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, yrange<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">sim_visium</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/CreateSimulationObject.html" class="external-link">CreateSimulationObject</a></span><span class="op">(</span>sims<span class="op">=</span><span class="fl">1</span>, cell_types<span class="op">=</span><span class="fl">1</span>, window<span class="op">=</span><span class="va">wdw</span><span class="op">)</span></code></pre></div>
<p>Next, the <code>sc.SpatialSIM</code> is used to generate the spatial
point process (positions of the spots) within the observation window.
Then, assignments of spots to tissue domains are simulated and
visualized:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate point process</span>
<span class="co"># Then, simulate tissue compartments</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span>
<span class="va">sim_visium</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/GenerateSpatialPattern.html" class="external-link">GenerateSpatialPattern</a></span><span class="op">(</span><span class="va">sim_visium</span>, gridded<span class="op">=</span><span class="cn">T</span>, overwrite<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/GenerateTissue.html" class="external-link">GenerateTissue</a></span><span class="op">(</span>k<span class="op">=</span><span class="fl">1</span>, xmin<span class="op">=</span><span class="fl">1</span>, xmax<span class="op">=</span><span class="fl">2</span>, ymin<span class="op">=</span><span class="fl">1</span>, ymax<span class="op">=</span><span class="fl">2</span>, sdmin<span class="op">=</span><span class="fl">1</span>, sdmax<span class="op">=</span><span class="fl">2</span>, overwrite<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; x and y range inside window boundary</span>
<span class="co">#&gt; Computing tissue probability</span>

<span class="fu"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/PlotSimulation.html" class="external-link">PlotSimulation</a></span><span class="op">(</span><span class="va">sim_visium</span>, which<span class="op">=</span><span class="fl">1</span>, what<span class="op">=</span><span class="st">"tissue points"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/tissue_sim_2-1.png" width="384"></p>
<p>Now, the simulated tissue domain assignments are extracted from the
<code>SpatSimObj</code> object. Gene counts will be simulated in such a
way that:</p>
<ul>
<li>Expression of “gene_1” is exclusive to “Tissue_1”. If a spot was
assigned to “Tissue 1”, expression of “gene_1” is 1 (high expression).
If assigned to “Tissue 2”, expression of “gene_1” is 0.1 (low
expression). Given “Tissue 1” spots are aggregated towards the center of
the tissue, it is expected that Moran’s I &gt; 0 and Geary’s C &lt; 1
for “gene_1”.<br>
</li>
<li>Spots with high expression of “gene_2” (expression = 1) are equally
separated from spots with low expression (expression = 0.1). This
pattern is highly unlikely in a biological tissue. It is expected this
pattern yields a Moran’s I &lt; 0 and a Geary’s &gt; 1.</li>
<li>Expression of “gene_3” results from randomly assigning expression of
“gene_2” across the entire tissue. This pattern should result in Moran’s
I closer to 0 and Geary’s C closer to 1.</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extract tissue assignments from the `SpatSimObj` object</span>
<span class="co"># Simulate expression of 'gene_1'</span>
<span class="va">sim_visium_df</span> <span class="op">&lt;-</span> <span class="va">sim_visium</span><span class="op">@</span><span class="va">`Spatial Files`</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gene_1<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">tissue_assignment</span> <span class="op">==</span> <span class="st">'Tissue 1'</span> <span class="op">~</span> <span class="fl">1</span>, <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Generate expression patter of "gene_2"</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim_visium_df</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
    <span class="va">sim_visium_df</span><span class="op">[</span><span class="va">i</span>, <span class="st">'gene_2'</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
    <span class="va">sim_visium_df</span><span class="op">[</span><span class="va">i</span>, <span class="st">'gene_2'</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0.1</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># Generate expression of "gene_3"</span>
<span class="co"># Set seed for resproducibility</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span>
<span class="va">sim_visium_df</span><span class="op">[[</span><span class="st">'gene_3'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">sim_visium_df</span><span class="op">[[</span><span class="st">'gene_2'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>To visualize the simulated expression and run <code>SThet</code>, an
STlist is created:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extract simulated expression data</span>
<span class="va">sim_expr</span> <span class="op">&lt;-</span> <span class="va">sim_visium_df</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span>libname<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'spot'</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'libname'</span>, <span class="st">'gene_1'</span>, <span class="st">'gene_2'</span>, <span class="st">'gene_3'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">column_to_rownames</a></span><span class="op">(</span><span class="st">'libname'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">'genename'</span><span class="op">)</span>

<span class="co"># Extract simulated spot locations</span>
<span class="va">sim_xy</span> <span class="op">&lt;-</span> <span class="va">sim_visium_df</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span>libname<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'spot'</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/sc.SpatialSIM/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'libname'</span>, <span class="st">'y'</span>, <span class="st">'x'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># The `STlist` function can take a list of data frames</span>
<span class="va">simulated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STlist.html">STlist</a></span><span class="op">(</span>rnacounts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sim_visium<span class="op">=</span><span class="va">sim_expr</span><span class="op">)</span>, 
                   spotcoords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sim_visium<span class="op">=</span><span class="va">sim_xy</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #00BB00;">Found list of dataframes.</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; </span><span style="color: #BBBB00;">Matching gene expression and coordinate data...</span></span>
<span class="co"><span style="color: #BBBB00;">#&gt; Converting counts to sparse matrices</span></span>
<span class="co"><span style="color: #BBBB00;">#&gt; </span><span style="color: #00BB00; font-weight: bold;">Completed STlist!</span></span>
<span class="co"><span style="color: #00BB00; font-weight: bold;">#&gt; </span></span>

<span class="co"># Plot expression</span>
<span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STplot.html">STplot</a></span><span class="op">(</span><span class="va">simulated</span>, genes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'gene_1'</span>, <span class="st">'gene_2'</span>, <span class="st">'gene_3'</span><span class="op">)</span>, data_type<span class="op">=</span><span class="st">'raw'</span>, color_pal<span class="op">=</span><span class="st">'sunset'</span>, ptsize<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span>plotlist<span class="op">=</span><span class="va">ps</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="basic_functions_vignette_files/figure-html/tissue_sim_4-1.png" width="768"></p>
<p>As expected, simulated expression of “gene_1” is aggregated (i.e.,
clustered, red spots concentrated towards the center of the tissue).
This result was intently obtained by setting the simulation parameters
to <code>xmin=2</code>, <code>xmax=3</code>, <code>ymin=2</code>,
<code>ymax=3</code> in <code>sc.SpatialSIM</code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The `SThet` function requires normalized data</span>
<span class="va">simulated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transform_data.html">transform_data</a></span><span class="op">(</span><span class="va">simulated</span><span class="op">)</span>

<span class="co"># Run `SThet`</span>
<span class="va">simulated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SThet.html">SThet</a></span><span class="op">(</span><span class="va">simulated</span>, genes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'gene_1'</span>, <span class="st">'gene_2'</span>, <span class="st">'gene_3'</span><span class="op">)</span>, method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'moran'</span>, <span class="st">'geary'</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #00BB00;">SThet started.</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; </span><span style="color: #BBBB00;">   Calculating spatial weights...</span></span>
<span class="co"><span style="color: #BBBB00;">#&gt; </span><span style="color: #00BB00;">SThet completed in 0.02 min.</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; </span></span>

<span class="co"># Extract results</span>
<span class="fu"><a href="../reference/get_gene_meta.html">get_gene_meta</a></span><span class="op">(</span><span class="va">simulated</span>, sthet_only<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 6</span></span>
<span class="co">#&gt;   sample     gene   gene_mean gene_stdevs  moran_i geary_c</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> sim_visium gene_1      7.80       0.974  0.019<span style="text-decoration: underline;">3</span>    0.966</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> sim_visium gene_2      7.68       0.957 -<span style="color: #BB0000;">0.015</span><span style="color: #BB0000; text-decoration: underline;">6</span>    1.01 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> sim_visium gene_3      7.68       1.01   0.003<span style="text-decoration: underline;">71</span>   0.987</span></code></pre></div>
<p>The results for each of the metrics are as expected: “gene_1” shows
aggregation/clustering, indicative of “hot-spot” expression. “gene_2”
and “gene_3” show uniform and random expression respectively. Notice
that none of these values are very far from the “random” expectation
(Moran’s I = 0 and Geary’s C = 1). One of reasons for this result is the
effect of library-size normalization. In addition, obtaining extreme
values of I and C require extreme spatial patterns, which are unlikely
to be observed even in the way data has been simulated here.</p>
</details>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bassiouni_2023" class="csl-entry">
Bassiouni, Rania, Michael O. Idowu, Lee D. Gibbs, Valentina Robila,
Pamela J. Grizzard, Michelle G. Webb, Jiarong Song, Ashley Noriega,
David W. Craig, and John D. Carpten. 2023. <span>“Spatial Transcriptomic
Analysis of a Diverse Patient Cohort Reveals a Conserved Architecture in
Triple-Negative Breast Cancer.”</span> <em>Cancer Research</em> 83:
34–48. <a href="https://doi.org/10.1158/0008-5472.CAN-22-2682" class="external-link">https://doi.org/10.1158/0008-5472.CAN-22-2682</a>.
</div>
<div id="ref-hafemeister_2019" class="csl-entry">
Hafemeister, Christoph, and Rahul Satija. 2019. <span>“Normalization and
Variance Stabilization of Single-Cell RNA-Seq Data Using Regularized
Negative Binomial Regression.”</span> <em>Genome Biology</em> 20: 296.
<a href="https://doi.org/10.1186/s13059-019-1874-1" class="external-link">https://doi.org/10.1186/s13059-019-1874-1</a>.
</div>
<div id="ref-langfelder_2008" class="csl-entry">
Langfelder, Peter, Bin Zhang, and Steve Horvath. 2007. <span>“<span class="nocase">Defining clusters from a hierarchical cluster tree: the
Dynamic Tree Cut package for R</span>.”</span> <em>Bioinformatics</em>
24: 719–20. <a href="https://doi.org/10.1093/bioinformatics/btm563" class="external-link">https://doi.org/10.1093/bioinformatics/btm563</a>.
</div>
<div id="ref-ospina_2022" class="csl-entry">
Ospina, Oscar E, Christopher M Wilson, Alex C Soupir, Anders Berglund,
Inna Smalley, Kenneth Y Tsai, and Brooke L Fridley. 2022. <span>“<span class="nocase">spatialGE: quantification and visualization of the tumor
microenvironment heterogeneity using spatial
transcriptomics</span>.”</span> <em>Bioinformatics</em> 38: 2645–47. <a href="https://doi.org/10.1093/bioinformatics/btac145" class="external-link">https://doi.org/10.1093/bioinformatics/btac145</a>.
</div>
</div>
<details><summary><strong>Session Info</strong>
</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 4.1.2 (2021-11-01)</span>
<span class="co">#&gt; Platform: x86_64-apple-darwin17.0 (64-bit)</span>
<span class="co">#&gt; Running under: macOS Big Sur 10.16</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib</span>
<span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt;  [1] janitor_2.1.0            forcats_0.5.1            stringr_1.5.0           </span>
<span class="co">#&gt;  [4] dplyr_1.1.0              purrr_1.0.1              readr_2.1.2             </span>
<span class="co">#&gt;  [7] tidyr_1.3.0              tibble_3.2.1             tidyverse_1.3.1         </span>
<span class="co">#&gt; [10] sc.SpatialSIM_0.0.0.9000 spatstat_2.3-0           spatstat.linnet_2.3-1   </span>
<span class="co">#&gt; [13] spatstat.core_2.3-2      rpart_4.1-15             nlme_3.1-153            </span>
<span class="co">#&gt; [16] spatstat.geom_3.0-6      spatstat.data_3.0-0      magrittr_2.0.2          </span>
<span class="co">#&gt; [19] ggpolypath_0.1.0         ggplot2_3.3.5            fields_14.1             </span>
<span class="co">#&gt; [22] viridis_0.6.2            viridisLite_0.4.0        spam_2.9-1              </span>
<span class="co">#&gt; [25] spatialGE_1.1.0         </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;   [1] scattermore_0.7       SeuratObject_4.0.4    ragg_1.2.5           </span>
<span class="co">#&gt;   [4] bit64_4.0.5           knitr_1.37            irlba_2.3.5          </span>
<span class="co">#&gt;   [7] data.table_1.14.2     doParallel_1.0.16     generics_0.1.2       </span>
<span class="co">#&gt;  [10] BiocGenerics_0.40.0   terra_1.7-3           cowplot_1.1.1        </span>
<span class="co">#&gt;  [13] RANN_2.6.1            proxy_0.4-26          future_1.23.0        </span>
<span class="co">#&gt;  [16] wordspace_0.2-6       bit_4.0.4             tzdb_0.3.0           </span>
<span class="co">#&gt;  [19] wk_0.6.0              webshot_0.5.2         xml2_1.3.3           </span>
<span class="co">#&gt;  [22] lubridate_1.8.0       httpuv_1.6.5          assertthat_0.2.1     </span>
<span class="co">#&gt;  [25] xfun_0.31             hms_1.1.1             jquerylib_0.1.4      </span>
<span class="co">#&gt;  [28] evaluate_0.14         promises_1.2.0.1      fansi_1.0.2          </span>
<span class="co">#&gt;  [31] dbplyr_2.1.1          readxl_1.3.1          igraph_1.2.11        </span>
<span class="co">#&gt;  [34] DBI_1.1.2             htmlwidgets_1.5.4     sparsesvd_0.2        </span>
<span class="co">#&gt;  [37] reshape_0.8.9         stats4_4.1.2          spdep_1.2-2          </span>
<span class="co">#&gt;  [40] ellipsis_0.3.2        ggpubr_0.4.0          backports_1.4.1      </span>
<span class="co">#&gt;  [43] V8_4.0.0              deldir_1.0-6          vctrs_0.6.2          </span>
<span class="co">#&gt;  [46] Cairo_1.6-0           ROCR_1.0-11           abind_1.4-5          </span>
<span class="co">#&gt;  [49] cachem_1.0.6          withr_2.5.0           ggforce_0.3.3        </span>
<span class="co">#&gt;  [52] rgdal_1.6-4           vroom_1.5.7           sctransform_0.3.3    </span>
<span class="co">#&gt;  [55] goftest_1.2-3         svglite_2.0.0         cluster_2.1.2        </span>
<span class="co">#&gt;  [58] dotCall64_1.0-1       lazyeval_0.2.2        crayon_1.4.2         </span>
<span class="co">#&gt;  [61] hdf5r_1.3.8           units_0.7-2           pkgconfig_2.0.3      </span>
<span class="co">#&gt;  [64] labeling_0.4.2        tweenr_1.0.2          rlang_1.1.1          </span>
<span class="co">#&gt;  [67] globals_0.14.0        lifecycle_1.0.3       miniUI_0.1.1.1       </span>
<span class="co">#&gt;  [70] modelr_0.1.8          cellranger_1.1.0      rprojroot_2.0.2      </span>
<span class="co">#&gt;  [73] polyclip_1.10-0       matrixStats_0.61.0    lmtest_0.9-39        </span>
<span class="co">#&gt;  [76] Matrix_1.4-1          raster_3.5-15         carData_3.0-5        </span>
<span class="co">#&gt;  [79] boot_1.3-28           zoo_1.8-9             reprex_2.0.1         </span>
<span class="co">#&gt;  [82] ggridges_0.5.3        GlobalOptions_0.1.2   png_0.1-7            </span>
<span class="co">#&gt;  [85] rjson_0.2.21          KernSmooth_2.23-20    shape_1.4.6          </span>
<span class="co">#&gt;  [88] classInt_0.4-3        s2_1.1.2              parallelly_1.30.0    </span>
<span class="co">#&gt;  [91] iotools_0.3-2         rstatix_0.7.0         S4Vectors_0.32.3     </span>
<span class="co">#&gt;  [94] ggsignif_0.6.3        scales_1.2.0          memoise_2.0.1        </span>
<span class="co">#&gt;  [97] plyr_1.8.6            ica_1.0-2             compiler_4.1.2       </span>
<span class="co">#&gt; [100] kableExtra_1.3.4      concaveman_1.1.0      RColorBrewer_1.1-2   </span>
<span class="co">#&gt; [103] clue_0.3-60           fitdistrplus_1.1-6    snakecase_0.11.0     </span>
<span class="co">#&gt; [106] cli_3.6.0             listenv_0.8.0         patchwork_1.1.1      </span>
<span class="co">#&gt; [109] pbapply_1.5-0         MASS_7.3-54           mgcv_1.8-38          </span>
<span class="co">#&gt; [112] tidyselect_1.2.0      stringi_1.7.6         textshaping_0.3.6    </span>
<span class="co">#&gt; [115] highr_0.9             yaml_2.2.2            ggrepel_0.9.1        </span>
<span class="co">#&gt; [118] pbmcapply_1.5.1       grid_4.1.2            sass_0.4.0           </span>
<span class="co">#&gt; [121] tools_4.1.2           future.apply_1.8.1    parallel_4.1.2       </span>
<span class="co">#&gt; [124] circlize_0.4.14       rstudioapi_0.13       khroma_1.8.0         </span>
<span class="co">#&gt; [127] foreach_1.5.2         gridExtra_2.3         farver_2.1.0         </span>
<span class="co">#&gt; [130] Rtsne_0.15            digest_0.6.29         rgeos_0.5-9          </span>
<span class="co">#&gt; [133] shiny_1.7.1           Rcpp_1.0.10           car_3.0-12           </span>
<span class="co">#&gt; [136] broom_0.7.12          later_1.3.0           RcppAnnoy_0.0.19     </span>
<span class="co">#&gt; [139] httr_1.4.2            sf_1.0-9              ComplexHeatmap_2.11.1</span>
<span class="co">#&gt; [142] colorspace_2.0-2      rvest_1.0.2           fs_1.5.2             </span>
<span class="co">#&gt; [145] tensor_1.5            reticulate_1.24       IRanges_2.28.0       </span>
<span class="co">#&gt; [148] splines_4.1.2         uwot_0.1.11           spatstat.utils_3.0-1 </span>
<span class="co">#&gt; [151] pkgdown_2.0.7         sp_1.4-6              plotly_4.10.0        </span>
<span class="co">#&gt; [154] spData_2.0.1          systemfonts_1.0.4     xtable_1.8-4         </span>
<span class="co">#&gt; [157] jsonlite_1.7.3        dynamicTreeCut_1.63-1 R6_2.5.1             </span>
<span class="co">#&gt; [160] pillar_1.8.1          htmltools_0.5.2       mime_0.12            </span>
<span class="co">#&gt; [163] glue_1.6.2            fastmap_1.1.0         class_7.3-19         </span>
<span class="co">#&gt; [166] codetools_0.2-18      maps_3.4.0            utf8_1.2.2           </span>
<span class="co">#&gt; [169] lattice_0.20-45       bslib_0.3.1           spatstat.sparse_3.0-0</span>
<span class="co">#&gt; [172] curl_4.3.2            leiden_0.3.9          magick_2.7.3         </span>
<span class="co">#&gt; [175] survival_3.4-0        rmarkdown_2.14        desc_1.4.2           </span>
<span class="co">#&gt; [178] munsell_0.5.0         e1071_1.7-9           GetoptLong_1.0.5     </span>
<span class="co">#&gt; [181] iterators_1.0.13      haven_2.4.3           reshape2_1.4.4       </span>
<span class="co">#&gt; [184] gtable_0.3.0          Seurat_4.1.0</span></code></pre></div>
</details>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Oscar Ospina, Brooke Fridley, Alex Soupir.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
